{"tags":[{"name":"docker","permalink":"http://catlittlechen.com/tags/docker/","url":"/async/tags/docker.json","count":1}],"categories":[{"name":"docker","permalink":"http://catlittlechen.com/categories/docker/","url":"/async/categories/docker.json","count":1}],"url":"/async/posts/2016/07/22/docker-swarm.json","date":1469199108000,"path":{"year":2016,"month":7,"day":22,"name":"docker-swarm"},"title":"docker-swarm","permalink":"http://catlittlechen.com/2016/07/22/docker-swarm/","content":"<p>前段时间，我和公司的运维朋友一起玩了下docker。在配置docker-swarm的时候，运维朋友可以安逸地开启aws，可怜的我只能默默地在自己的单机上面搭建了~~</p>\n<p>所以，才有了今天在用docker-machine来搭建docker-swarm，这份教程基本是按照docker-swram的官方教程改的~</p>\n<h4 id=\"u521B_u5EFAdocker-machine\"><a href=\"#u521B_u5EFAdocker-machine\" class=\"headerlink\" title=\"创建docker-machine\"></a>创建docker-machine</h4><pre><code>docker-machine create --driver virtualbox consul\ndocker-machine create --driver virtualbox manager1\ndocker-machine create --driver virtualbox manager2\ndocker-machine create --driver virtualbox node1\ndocker-machine create --driver virtualbox node2\n</code></pre><h4 id=\"u914D_u7F6Econsul\"><a href=\"#u914D_u7F6Econsul\" class=\"headerlink\" title=\"配置consul\"></a>配置consul</h4><p>切换到consul虚机里面：</p>\n<pre><code>eval $(docker-machine env consul)\n</code></pre><p>启动consul服务：</p>\n<pre><code>docker run -d -p 8500:8500 --name=consul progrium/consul -server -bootstrap\n</code></pre><h4 id=\"u914D_u7F6Emanager_u8282_u70B9\"><a href=\"#u914D_u7F6Emanager_u8282_u70B9\" class=\"headerlink\" title=\"配置manager节点\"></a>配置manager节点</h4><p>配置manager1节点：</p>\n<pre><code>eval $(docker-machine env manager1)\ndocker run -d -p 4000:4000 -v /var/lib/boot2docker:/certs:ro swarm manage -H :4000 --tlsverify --tlscacert=/certs/ca.pem --tlscert=/certs/server.pem --tlskey=/certs/server-key.pem --replication --advertise $(docker-machine ip manager1):4000 consul://$(docker-machine ip consul):8500\n</code></pre><p>配置manager2节点：</p>\n<pre><code>eval $(docker-machine env manager2)\ndocker run -d -p 4000:4000 -v /var/lib/boot2docker:/certs:ro swarm manage -H :4000 --tlsverify --tlscacert=/certs/ca.pem --tlscert=/certs/server.pem --tlskey=/certs/server-key.pem --replication --advertise $(docker-machine ip manager2):4000 consul://$(docker-machine ip consul):8500\n</code></pre><h4 id=\"u914D_u7F6Enode_u8282_u70B9\"><a href=\"#u914D_u7F6Enode_u8282_u70B9\" class=\"headerlink\" title=\"配置node节点\"></a>配置node节点</h4><p>配置node1节点</p>\n<pre><code>eval $(docker-machine env node1)\ndocker run -d swarm join --advertise=$(docker-machine ip node1):2376 consul://$(docker-machine ip consul):8500\n</code></pre><p>配置node2节点</p>\n<pre><code>eval $(docker-machine env node2)\ndocker run -d swarm join --advertise=$(docker-machine ip node2):2376 consul://$(docker-machine ip consul):8500\n</code></pre><h3 id=\"u6D4B_u8BD5\"><a href=\"#u6D4B_u8BD5\" class=\"headerlink\" title=\"测试\"></a>测试</h3><pre><code>docker -H :4000 --tlsverify --tlscacert=/var/lib/boot2docker/ca.pem --tlscert=/var/lib/boot2docker/server.pem --tlskey=/var/lib/boot2docker/server-key.pem run hello-world\n</code></pre>"}