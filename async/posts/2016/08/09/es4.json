{"tags":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6},{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":7}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/09/es4.json","date":1470703879000,"path":{"year":2016,"month":8,"day":9,"name":"es4"},"title":"elasticsearch系列笔记(四) 搜索","permalink":"http://catlittlechen.com/2016/08/09/es4/","content":"<h4 id=\"u8DEF_u7531_u6587_u6863_u5230_u5206_u7247\"><a href=\"#u8DEF_u7531_u6587_u6863_u5230_u5206_u7247\" class=\"headerlink\" title=\"路由文档到分片\"></a>路由文档到分片</h4><figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shard = hash<span class=\"comment\">(routing)</span> <span class=\"preprocessor\">%</span> <span class=\"label\">number_of_primary_shards</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"replication\"><a href=\"#replication\" class=\"headerlink\" title=\"replication\"></a>replication</h4><pre><code>请求是否需要等待复制分区的成功响应，默认为sync等待，async异步不等待。 \n</code></pre><h4 id=\"consistency\"><a href=\"#consistency\" class=\"headerlink\" title=\"consistency\"></a>consistency</h4><pre><code>文档在写入的时候，需要规定一定的分区更新成功之后，才会返回客户端成功，如果节点不够，则不能删除或者索引任何文件\n\nint((primary + number_of_replicas) / 2) + 1\n</code></pre><h4 id=\"u7A7A_u641C_u7D22\"><a href=\"#u7A7A_u641C_u7D22\" class=\"headerlink\" title=\"空搜索\"></a>空搜索</h4><figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /_search</span><br><span class=\"line\">    hits:</span><br><span class=\"line\">        total 总文档数</span><br><span class=\"line\">        hits 匹配到的数量</span><br><span class=\"line\">        max_score 最大相关性</span><br><span class=\"line\">    took：请求时间</span><br><span class=\"line\">    _shards: 用到的分片大小和类型</span><br><span class=\"line\">GET /_search?size=&#123;size&#125;&amp;<span class=\"keyword\">from</span>=&#123;<span class=\"keyword\">from</span>&#125;</span><br><span class=\"line\">    从<span class=\"keyword\">from</span>开始最多size个内容返回</span><br></pre></td></tr></table></figure>\n<h4 id=\"u7B80_u6613_u641C_u7D22\"><a href=\"#u7B80_u6613_u641C_u7D22\" class=\"headerlink\" title=\"简易搜索\"></a>简易搜索</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /_all/&#123;type&#125;/_search?q=&#123;field&#125;:&#123;key&#125;</span><br><span class=\"line\">GET /_all/&#123;type&#125;/_search?q=`urlencode(+&#123;field&#125;:&#123;key&#125;-&#123;field&#125;:&#123;key&#125;)` +条件满足 -条件不满足</span><br><span class=\"line\">GET /_all/&#123;type&#125;/_search?q=&#123;value&#125; 查询包含<span class=\"keyword\">value</span>的文档</span><br></pre></td></tr></table></figure>\n<h4 id=\"u65B0_u5EFA_u7D22_u5F15_uFF0C_u8BBE_u7F6E_u5206_u6790_u5668\"><a href=\"#u65B0_u5EFA_u7D22_u5F15_uFF0C_u8BBE_u7F6E_u5206_u6790_u5668\" class=\"headerlink\" title=\"新建索引，设置分析器\"></a>新建索引，设置分析器</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /&#123;index&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"mappings\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"&#123;type&#125;\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"properties\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"field\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"type\"</span>: <span class=\"string\">\"\"</span>, //string, date, long, object(嵌套)</span><br><span class=\"line\">                    <span class=\"string\">\"index\"</span>: <span class=\"string\">\"\"</span>, // analyzed, not_analyzed, no</span><br><span class=\"line\">                    <span class=\"string\">\"analyzer\"</span>: <span class=\"string\">\"\"</span>, // english, space</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u6D4B_u8BD5_u5206_u6790_u5668\"><a href=\"#u6D4B_u8BD5_u5206_u6790_u5668\" class=\"headerlink\" title=\"测试分析器\"></a>测试分析器</h4><figure class=\"highlight mathematica\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /<span class=\"list\">&#123;index&#125;</span>/_analyze?field=<span class=\"list\">&#123;field&#125;</span>&amp;text=<span class=\"list\">&#123;value&#125;</span></span><br></pre></td></tr></table></figure>\n"}