{"tags":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6},{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/09/es4.json","date":1470703879000,"path":{"year":2016,"month":8,"day":9,"name":"es4"},"title":"elasticsearch系列笔记(四) 搜索","permalink":"http://catlittlechen.com/2016/08/09/es4/","content":"<h4 id=\"u8DEF_u7531_u6587_u6863_u5230_u5206_u7247\"><a href=\"#u8DEF_u7531_u6587_u6863_u5230_u5206_u7247\" class=\"headerlink\" title=\"路由文档到分片\"></a>路由文档到分片</h4><pre><code>shard = hash(routing) % number_of_primary_shards\n</code></pre><h4 id=\"replication\"><a href=\"#replication\" class=\"headerlink\" title=\"replication\"></a>replication</h4><pre><code>请求是否需要等待复制分区的成功响应，默认为sync等待，async异步不等待。 \n</code></pre><h4 id=\"consistency\"><a href=\"#consistency\" class=\"headerlink\" title=\"consistency\"></a>consistency</h4><pre><code>文档在写入的时候，需要规定一定的分区更新成功之后，才会返回客户端成功，如果节点不够，则不能删除或者索引任何文件\n\nint((primary + number_of_replicas) / 2) + 1\n</code></pre><h4 id=\"u7A7A_u641C_u7D22\"><a href=\"#u7A7A_u641C_u7D22\" class=\"headerlink\" title=\"空搜索\"></a>空搜索</h4><pre><code>GET /_search\n    hits:\n        total 总文档数\n        hits 匹配到的数量\n        max_score 最大相关性\n    took：请求时间\n    _shards: 用到的分片大小和类型\nGET /_search?size={size}&amp;from={from}\n    从from开始最多size个内容返回\n</code></pre><h4 id=\"u7B80_u6613_u641C_u7D22\"><a href=\"#u7B80_u6613_u641C_u7D22\" class=\"headerlink\" title=\"简易搜索\"></a>简易搜索</h4><pre><code>GET /_all/{type}/_search?q={field}:{key}\nGET /_all/{type}/_search?q=`urlencode(+{field}:{key}-{field}:{key})` +条件满足 -条件不满足\nGET /_all/{type}/_search?q={value} 查询包含value的文档\n</code></pre><h4 id=\"u65B0_u5EFA_u7D22_u5F15_uFF0C_u8BBE_u7F6E_u5206_u6790_u5668\"><a href=\"#u65B0_u5EFA_u7D22_u5F15_uFF0C_u8BBE_u7F6E_u5206_u6790_u5668\" class=\"headerlink\" title=\"新建索引，设置分析器\"></a>新建索引，设置分析器</h4><pre><code>PUT /{index}\n{\n    &quot;mappings&quot;: {\n        &quot;{type}&quot;: {\n            &quot;properties&quot;: {\n                &quot;field&quot;: {\n                    &quot;type&quot;: &quot;&quot;, //string, date, long, object(嵌套)\n                    &quot;index&quot;: &quot;&quot;, // analyzed, not_analyzed, no\n                    &quot;analyzer&quot;: &quot;&quot;, // english, space\n                }\n            }\n        }\n    }\n}\n</code></pre><h4 id=\"u6D4B_u8BD5_u5206_u6790_u5668\"><a href=\"#u6D4B_u8BD5_u5206_u6790_u5668\" class=\"headerlink\" title=\"测试分析器\"></a>测试分析器</h4><pre><code>GET /{index}/_analyze?field={field}&amp;text={value}\n</code></pre>"}