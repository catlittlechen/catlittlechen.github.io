{"tags":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6},{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/01/es1.json","date":1470050781000,"path":{"year":2016,"month":8,"day":1,"name":"es1"},"title":"elasticsearch系列笔记(一) 基础知识","permalink":"http://catlittlechen.com/2016/08/01/es1/","content":"<h3 id=\"install\"><a href=\"#install\" class=\"headerlink\" title=\"install\"></a>install</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">启动docker</span><br><span class=\"line\">docker run -ti <span class=\"comment\">--name es -p 9200:9200 ubuntu:14.04 /bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">更新系统</span><br><span class=\"line\">apt-get <span class=\"operator\"><span class=\"keyword\">update</span></span><br><span class=\"line\">apt-<span class=\"keyword\">get</span> <span class=\"keyword\">upgrade</span></span><br><span class=\"line\">apt-<span class=\"keyword\">get</span> <span class=\"keyword\">install</span> software-properties-common</span><br><span class=\"line\"></span><br><span class=\"line\">安装<span class=\"keyword\">java</span></span><br><span class=\"line\"><span class=\"keyword\">add</span>-apt-repository ppa:webupd8team/<span class=\"keyword\">java</span></span><br><span class=\"line\">apt-<span class=\"keyword\">get</span> <span class=\"keyword\">update</span></span><br><span class=\"line\">apt-<span class=\"keyword\">get</span> <span class=\"keyword\">install</span> <span class=\"keyword\">oracle</span>-java8-installer</span><br><span class=\"line\"></span><br><span class=\"line\">安装es</span><br><span class=\"line\">wget -qO - https://packages.elastic.co/GPG-<span class=\"keyword\">KEY</span>-elasticsearch | sudo apt-<span class=\"keyword\">key</span> <span class=\"keyword\">add</span> -</span><br><span class=\"line\">echo <span class=\"string\">\"deb https://packages.elastic.co/elasticsearch/2.x/debian stable main\"</span> &gt;&gt; /etc/apt/sources.<span class=\"keyword\">list</span></span><br><span class=\"line\">apt-<span class=\"keyword\">get</span> <span class=\"keyword\">update</span> &amp;&amp; apt-<span class=\"keyword\">get</span> <span class=\"keyword\">install</span> elasticsearch</span><br><span class=\"line\"><span class=\"keyword\">update</span>-rc.<span class=\"keyword\">d</span> elasticsearch <span class=\"keyword\">defaults</span> <span class=\"number\">95</span> <span class=\"number\">10</span></span><br><span class=\"line\">/etc/init.<span class=\"keyword\">d</span>/elasticsearch <span class=\"keyword\">start</span></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"test\"><a href=\"#test\" class=\"headerlink\" title=\"test\"></a>test</h3><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title\">curl</span> -X GET <span class=\"string\">'http://172.17.0.2:9200'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"install_marvel\"><a href=\"#install_marvel\" class=\"headerlink\" title=\"install marvel\"></a>install marvel</h3><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">/usr/</span>share<span class=\"regexp\">/elasticsearch/</span>bin<span class=\"regexp\">/plugin -i elasticsearch/</span>marvel/latest</span><br><span class=\"line\"><span class=\"regexp\">/etc/</span>init.d/elasticsearch restart</span><br></pre></td></tr></table></figure>\n<h3 id=\"api\"><a href=\"#api\" class=\"headerlink\" title=\"api\"></a>api</h3><figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X&lt;VERB&gt; '&lt;PROTOCOL&gt;:<span class=\"comment\">//&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY_STRING&gt;' -d '&lt;BODY&gt;'</span></span><br><span class=\"line\">example :</span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/_count?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"match_all\"</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    '</span><br><span class=\"line\">    curl -XPUT <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/1?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"first_name\"</span> : <span class=\"string\">\"John\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"last_name\"</span> :  <span class=\"string\">\"Smith\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"age\"</span> :        <span class=\"number\">25</span>,</span><br><span class=\"line\">            <span class=\"string\">\"about\"</span> :      <span class=\"string\">\"I love to go rock climbing\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"interests\"</span>: [ <span class=\"string\">\"sports\"</span>, <span class=\"string\">\"music\"</span> ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    '</span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/1?pretty'</span></span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty'</span></span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty&amp;q=last_name:Smith'</span></span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"match\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"last_name\"</span>: <span class=\"string\">\"Smith\"</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    '</span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"filtered\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"filter\"</span>: &#123;</span><br><span class=\"line\">                        <span class=\"string\">\"range\"</span>: &#123;</span><br><span class=\"line\">                            <span class=\"string\">\"age\"</span>: &#123; <span class=\"string\">\"gt\"</span>: <span class=\"number\">20</span> &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">                        <span class=\"string\">\"match\"</span>: &#123;</span><br><span class=\"line\">                            <span class=\"string\">\"last_name\"</span>: <span class=\"string\">\"Smith\"</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    '</span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span> : &#123;</span><br><span class=\"line\">                <span class=\"string\">\"match\"</span> : &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"about\"</span> : <span class=\"string\">\"rock climbing\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    '</span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span> : &#123;</span><br><span class=\"line\">                <span class=\"string\">\"match_phrase\"</span> : &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"about\"</span> : <span class=\"string\">\"rock climbing\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    '</span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span> : &#123;</span><br><span class=\"line\">                <span class=\"string\">\"match_phrase\"</span> : &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"about\"</span> : <span class=\"string\">\"rock climbing\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">\"highlight\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"fields\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"about\"</span>: &#123;&#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    '</span><br><span class=\"line\">    curl -XGET <span class=\"string\">'http</span>:<span class=\"comment\">//172.17.0.2:9200/megacorp/employee/_search?pretty' -d '</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"aggs\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"all_interests\"</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">\"terms\"</span>: &#123; <span class=\"string\">\"field\"</span>: <span class=\"string\">\"interests\"</span> &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    '</span><br></pre></td></tr></table></figure>\n"}