{"tags":[{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":13},{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/12/es5.json","date":1471007819000,"path":{"year":2016,"month":8,"day":12,"name":"es5"},"title":"elasticsearch系列笔记(五) 结构化查询","permalink":"http://catlittlechen.com/2016/08/12/es5/","content":"<h4 id=\"结构化查询Query-DSL\"><a href=\"#结构化查询Query-DSL\" class=\"headerlink\" title=\"结构化查询Query DSL\"></a>结构化查询Query DSL</h4><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /_search</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\"><span class=\"symbol\">            QUERY_NAME:</span> &#123;</span><br><span class=\"line\"><span class=\"symbol\">                FIELD_NAME:</span> &#123;</span><br><span class=\"line\"><span class=\"symbol\">                    ARGUMENT:</span> VALUE,</span><br><span class=\"line\"><span class=\"symbol\">                    ARGUMENT:</span> VALUE,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"过滤查询Filter-DSL\"><a href=\"#过滤查询Filter-DSL\" class=\"headerlink\" title=\"过滤查询Filter DSL\"></a>过滤查询Filter DSL</h4><h4 id=\"term-过滤\"><a href=\"#term-过滤\" class=\"headerlink\" title=\"term 过滤\"></a>term 过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"term\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: &#123;value&#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"terms-过滤\"><a href=\"#terms-过滤\" class=\"headerlink\" title=\"terms 过滤\"></a>terms 过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"terms\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: [ &#123;value1&#125;, &#123;value2&#125; ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"range过滤\"><a href=\"#range过滤\" class=\"headerlink\" title=\"range过滤\"></a>range过滤</h4><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"range\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"gte\"</span>: <span class=\"number\">20</span>, //<span class=\"keyword\">gt</span> <span class=\"keyword\">gte</span>, <span class=\"keyword\">lt</span> <span class=\"keyword\">lte</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"exits-missing过滤\"><a href=\"#exits-missing过滤\" class=\"headerlink\" title=\"exits, missing过滤\"></a>exits, missing过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"exists\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"field\"</span>: <span class=\"string\">\"&#123;field&#125;\"</span>,//存在这个类型</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"过滤\"><a href=\"#过滤\" class=\"headerlink\" title=\"过滤\"></a>过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"bool\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"must\"</span>: &#123;&#125;,//必须符合</span><br><span class=\"line\">        <span class=\"string\">\"must_not\"</span>: &#123;&#125;,//必须不符合</span><br><span class=\"line\">        <span class=\"string\">\"should\"</span>: &#123;&#125;,//必须符合其中一个条件</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"match-all\"><a href=\"#match-all\" class=\"headerlink\" title=\"match_all\"></a>match_all</h4><h4 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h4><h4 id=\"multi-match\"><a href=\"#multi-match\" class=\"headerlink\" title=\"multi_match\"></a>multi_match</h4><h4 id=\"查询比过滤多了相关性计算\"><a href=\"#查询比过滤多了相关性计算\" class=\"headerlink\" title=\"查询比过滤多了相关性计算\"></a>查询比过滤多了相关性计算</h4><h4 id=\"复合查询\"><a href=\"#复合查询\" class=\"headerlink\" title=\"复合查询\"></a>复合查询</h4><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   \t<span class=\"attr\">\"filtered\"</span>: &#123;</span><br><span class=\"line\">       \t<span class=\"attr\">\"query\"</span>:  &#123; <span class=\"attr\">\"match\"</span>: &#123; <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"business opportunity\"</span> &#125;&#125;,</span><br><span class=\"line\">       \t<span class=\"attr\">\"filter\"</span>: &#123; <span class=\"attr\">\"term\"</span>:  &#123; <span class=\"attr\">\"folder\"</span>: <span class=\"string\">\"inbox\"</span> &#125;&#125;</span><br><span class=\"line\">   \t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"验证查询，解释错误\"><a href=\"#验证查询，解释错误\" class=\"headerlink\" title=\"验证查询，解释错误\"></a>验证查询，解释错误</h4><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET <span class=\"regexp\">/gb/</span>tweet<span class=\"regexp\">/_validate/</span>query?explain</span><br><span class=\"line\">   \t&#123;</span><br><span class=\"line\">       \t<span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">           \t*********</span><br><span class=\"line\">       \t&#125;</span><br><span class=\"line\">   \t&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"排序，在query之后\"><a href=\"#排序，在query之后\" class=\"headerlink\" title=\"排序，在query之后\"></a>排序，在query之后</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   \t<span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">   \t&#125;,</span><br><span class=\"line\">   \t<span class=\"string\">\"sort\"</span>: &#123;</span><br><span class=\"line\">   \t\t<span class=\"string\">\"&#123;field&#125;\"</span>:&#123;</span><br><span class=\"line\">   \t\t\t<span class=\"string\">\"order\"</span>: <span class=\"string\">\"desc\"</span></span><br><span class=\"line\">   \t\t&#125;,</span><br><span class=\"line\">   \t\t<span class=\"string\">\"&#123;field&#125;\"</span>:&#123;</span><br><span class=\"line\">   \t\t\t<span class=\"string\">\"order\"</span>: <span class=\"string\">\"asc\"</span>,</span><br><span class=\"line\">   \t\t\t<span class=\"string\">\"mode\"</span>: <span class=\"string\">\"min\"</span> //field为多个值时</span><br><span class=\"line\">       \t&#125;</span><br><span class=\"line\">   \t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"}