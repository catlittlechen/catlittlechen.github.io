{"tags":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6},{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/12/es5.json","date":1471007819000,"path":{"year":2016,"month":8,"day":12,"name":"es5"},"title":"elasticsearch系列笔记(五) 结构化查询","permalink":"http://catlittlechen.com/2016/08/12/es5/","content":"<h4 id=\"u7ED3_u6784_u5316_u67E5_u8BE2Query_DSL\"><a href=\"#u7ED3_u6784_u5316_u67E5_u8BE2Query_DSL\" class=\"headerlink\" title=\"结构化查询Query DSL\"></a>结构化查询Query DSL</h4><pre><code>GET /_search\n    {\n        &quot;query&quot;: {\n            QUERY_NAME: {\n                FIELD_NAME: {\n                    ARGUMENT: VALUE,\n                    ARGUMENT: VALUE,\n                }\n            }\n        }\n    }\n</code></pre><h4 id=\"u8FC7_u6EE4_u67E5_u8BE2Filter_DSL\"><a href=\"#u8FC7_u6EE4_u67E5_u8BE2Filter_DSL\" class=\"headerlink\" title=\"过滤查询Filter DSL\"></a>过滤查询Filter DSL</h4><h4 id=\"term__u8FC7_u6EE4\"><a href=\"#term__u8FC7_u6EE4\" class=\"headerlink\" title=\"term 过滤\"></a>term 过滤</h4><pre><code>{\n    &quot;term&quot;: {\n        &quot;{field}&quot;: {value} \n    }\n}\n</code></pre><h4 id=\"terms__u8FC7_u6EE4\"><a href=\"#terms__u8FC7_u6EE4\" class=\"headerlink\" title=\"terms 过滤\"></a>terms 过滤</h4><pre><code>{\n    &quot;terms&quot;: {\n        &quot;{field}&quot;: [ {value1}, {value2} ]\n    }\n}\n</code></pre><h4 id=\"range_u8FC7_u6EE4\"><a href=\"#range_u8FC7_u6EE4\" class=\"headerlink\" title=\"range过滤\"></a>range过滤</h4><pre><code>{\n    &quot;range&quot;: {\n        &quot;{field}&quot;: {\n            &quot;gte&quot;: 20, //gt gte, lt lte\n        }\n    }\n}\n</code></pre><h4 id=\"exits_2C_missing_u8FC7_u6EE4\"><a href=\"#exits_2C_missing_u8FC7_u6EE4\" class=\"headerlink\" title=\"exits, missing过滤\"></a>exits, missing过滤</h4><pre><code>{\n    &quot;exists&quot;: {\n        &quot;field&quot;: &quot;{field}&quot;,//存在这个类型\n    }\n}\n</code></pre><h4 id=\"u8FC7_u6EE4\"><a href=\"#u8FC7_u6EE4\" class=\"headerlink\" title=\"过滤\"></a>过滤</h4><pre><code>{\n    &quot;bool&quot;: {\n        &quot;must&quot;: {},//必须符合\n        &quot;must_not&quot;: {},//必须不符合\n        &quot;should&quot;: {},//必须符合其中一个条件\n    }\n}\n</code></pre><h4 id=\"match_all\"><a href=\"#match_all\" class=\"headerlink\" title=\"match_all\"></a>match_all</h4><h4 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h4><h4 id=\"multi_match\"><a href=\"#multi_match\" class=\"headerlink\" title=\"multi_match\"></a>multi_match</h4><h4 id=\"u67E5_u8BE2_u6BD4_u8FC7_u6EE4_u591A_u4E86_u76F8_u5173_u6027_u8BA1_u7B97\"><a href=\"#u67E5_u8BE2_u6BD4_u8FC7_u6EE4_u591A_u4E86_u76F8_u5173_u6027_u8BA1_u7B97\" class=\"headerlink\" title=\"查询比过滤多了相关性计算\"></a>查询比过滤多了相关性计算</h4><h4 id=\"u590D_u5408_u67E5_u8BE2\"><a href=\"#u590D_u5408_u67E5_u8BE2\" class=\"headerlink\" title=\"复合查询\"></a>复合查询</h4><pre><code>{\n    &quot;filtered&quot;: {\n        &quot;query&quot;:  { &quot;match&quot;: { &quot;email&quot;: &quot;business opportunity&quot; }},\n        &quot;filter&quot;: { &quot;term&quot;:  { &quot;folder&quot;: &quot;inbox&quot; }}\n    }\n}\n</code></pre><h4 id=\"u9A8C_u8BC1_u67E5_u8BE2_uFF0C_u89E3_u91CA_u9519_u8BEF\"><a href=\"#u9A8C_u8BC1_u67E5_u8BE2_uFF0C_u89E3_u91CA_u9519_u8BEF\" class=\"headerlink\" title=\"验证查询，解释错误\"></a>验证查询，解释错误</h4><pre><code>GET /gb/tweet/_validate/query?explain\n    {\n        &quot;query&quot;: {\n            *********\n        }\n    }\n</code></pre><h4 id=\"u6392_u5E8F_uFF0C_u5728query_u4E4B_u540E\"><a href=\"#u6392_u5E8F_uFF0C_u5728query_u4E4B_u540E\" class=\"headerlink\" title=\"排序，在query之后\"></a>排序，在query之后</h4><pre><code>GET /_search\n{\n    &quot;query&quot;: {\n    },\n    &quot;sort&quot;: {\n        &quot;{field}&quot;:{\n            &quot;order&quot;: &quot;desc&quot;\n        },\n        &quot;{field}&quot;:{\n            &quot;order&quot;: &quot;asc&quot;,\n            &quot;mode&quot;: &quot;min&quot; //field为多个值时\n        }\n    }\n}\n</code></pre>"}