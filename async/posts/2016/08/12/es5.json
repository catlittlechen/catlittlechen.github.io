{"tags":[{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":10},{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/12/es5.json","date":1471007819000,"path":{"year":2016,"month":8,"day":12,"name":"es5"},"title":"elasticsearch系列笔记(五) 结构化查询","permalink":"http://catlittlechen.com/2016/08/12/es5/","content":"<h4 id=\"u7ED3_u6784_u5316_u67E5_u8BE2Query_DSL\"><a href=\"#u7ED3_u6784_u5316_u67E5_u8BE2Query_DSL\" class=\"headerlink\" title=\"结构化查询Query DSL\"></a>结构化查询Query DSL</h4><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">GET /_search</div><div class=\"line\">    &#123;</div><div class=\"line\">        <span class=\"string\">\"query\"</span>: &#123;</div><div class=\"line\"><span class=\"symbol\">            QUERY_NAME:</span> &#123;</div><div class=\"line\"><span class=\"symbol\">                FIELD_NAME:</span> &#123;</div><div class=\"line\"><span class=\"symbol\">                    ARGUMENT:</span> VALUE,</div><div class=\"line\"><span class=\"symbol\">                    ARGUMENT:</span> VALUE,</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h4 id=\"u8FC7_u6EE4_u67E5_u8BE2Filter_DSL\"><a href=\"#u8FC7_u6EE4_u67E5_u8BE2Filter_DSL\" class=\"headerlink\" title=\"过滤查询Filter DSL\"></a>过滤查询Filter DSL</h4><h4 id=\"term__u8FC7_u6EE4\"><a href=\"#term__u8FC7_u6EE4\" class=\"headerlink\" title=\"term 过滤\"></a>term 过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"string\">\"term\"</span>: &#123;</div><div class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: &#123;value&#125; </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"terms__u8FC7_u6EE4\"><a href=\"#terms__u8FC7_u6EE4\" class=\"headerlink\" title=\"terms 过滤\"></a>terms 过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"string\">\"terms\"</span>: &#123;</div><div class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: [ &#123;value1&#125;, &#123;value2&#125; ]</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"range_u8FC7_u6EE4\"><a href=\"#range_u8FC7_u6EE4\" class=\"headerlink\" title=\"range过滤\"></a>range过滤</h4><figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"string\">\"range\"</span>: &#123;</div><div class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: &#123;</div><div class=\"line\">            <span class=\"string\">\"gte\"</span>: <span class=\"number\">20</span>, //<span class=\"keyword\">gt</span> <span class=\"keyword\">gte</span>, <span class=\"keyword\">lt</span> <span class=\"keyword\">lte</span></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"exits_2C_missing_u8FC7_u6EE4\"><a href=\"#exits_2C_missing_u8FC7_u6EE4\" class=\"headerlink\" title=\"exits, missing过滤\"></a>exits, missing过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"string\">\"exists\"</span>: &#123;</div><div class=\"line\">        <span class=\"string\">\"field\"</span>: <span class=\"string\">\"&#123;field&#125;\"</span>,//存在这个类型</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"u8FC7_u6EE4\"><a href=\"#u8FC7_u6EE4\" class=\"headerlink\" title=\"过滤\"></a>过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"string\">\"bool\"</span>: &#123;</div><div class=\"line\">        <span class=\"string\">\"must\"</span>: &#123;&#125;,//必须符合</div><div class=\"line\">        <span class=\"string\">\"must_not\"</span>: &#123;&#125;,//必须不符合</div><div class=\"line\">        <span class=\"string\">\"should\"</span>: &#123;&#125;,//必须符合其中一个条件</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"match_all\"><a href=\"#match_all\" class=\"headerlink\" title=\"match_all\"></a>match_all</h4><h4 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h4><h4 id=\"multi_match\"><a href=\"#multi_match\" class=\"headerlink\" title=\"multi_match\"></a>multi_match</h4><h4 id=\"u67E5_u8BE2_u6BD4_u8FC7_u6EE4_u591A_u4E86_u76F8_u5173_u6027_u8BA1_u7B97\"><a href=\"#u67E5_u8BE2_u6BD4_u8FC7_u6EE4_u591A_u4E86_u76F8_u5173_u6027_u8BA1_u7B97\" class=\"headerlink\" title=\"查询比过滤多了相关性计算\"></a>查询比过滤多了相关性计算</h4><h4 id=\"u590D_u5408_u67E5_u8BE2\"><a href=\"#u590D_u5408_u67E5_u8BE2\" class=\"headerlink\" title=\"复合查询\"></a>复合查询</h4><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&#123;</div><div class=\"line\">   \t<span class=\"attr\">\"filtered\"</span>: &#123;</div><div class=\"line\">       \t<span class=\"attr\">\"query\"</span>:  &#123; <span class=\"attr\">\"match\"</span>: &#123; <span class=\"attr\">\"email\"</span>: <span class=\"string\">\"business opportunity\"</span> &#125;&#125;,</div><div class=\"line\">       \t<span class=\"attr\">\"filter\"</span>: &#123; <span class=\"attr\">\"term\"</span>:  &#123; <span class=\"attr\">\"folder\"</span>: <span class=\"string\">\"inbox\"</span> &#125;&#125;</div><div class=\"line\">   \t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"u9A8C_u8BC1_u67E5_u8BE2_uFF0C_u89E3_u91CA_u9519_u8BEF\"><a href=\"#u9A8C_u8BC1_u67E5_u8BE2_uFF0C_u89E3_u91CA_u9519_u8BEF\" class=\"headerlink\" title=\"验证查询，解释错误\"></a>验证查询，解释错误</h4><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">GET <span class=\"regexp\">/gb/</span>tweet<span class=\"regexp\">/_validate/</span>query?explain</div><div class=\"line\">   \t&#123;</div><div class=\"line\">       \t<span class=\"string\">\"query\"</span>: &#123;</div><div class=\"line\">           \t*********</div><div class=\"line\">       \t&#125;</div><div class=\"line\">   \t&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"u6392_u5E8F_uFF0C_u5728query_u4E4B_u540E\"><a href=\"#u6392_u5E8F_uFF0C_u5728query_u4E4B_u540E\" class=\"headerlink\" title=\"排序，在query之后\"></a>排序，在query之后</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">GET /_search</div><div class=\"line\">&#123;</div><div class=\"line\">   \t<span class=\"string\">\"query\"</span>: &#123;</div><div class=\"line\">   \t&#125;,</div><div class=\"line\">   \t<span class=\"string\">\"sort\"</span>: &#123;</div><div class=\"line\">   \t\t<span class=\"string\">\"&#123;field&#125;\"</span>:&#123;</div><div class=\"line\">   \t\t\t<span class=\"string\">\"order\"</span>: <span class=\"string\">\"desc\"</span></div><div class=\"line\">   \t\t&#125;,</div><div class=\"line\">   \t\t<span class=\"string\">\"&#123;field&#125;\"</span>:&#123;</div><div class=\"line\">   \t\t\t<span class=\"string\">\"order\"</span>: <span class=\"string\">\"asc\"</span>,</div><div class=\"line\">   \t\t\t<span class=\"string\">\"mode\"</span>: <span class=\"string\">\"min\"</span> //field为多个值时</div><div class=\"line\">       \t&#125;</div><div class=\"line\">   \t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n"}