{"tags":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6},{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/12/es5.json","date":1471007819000,"path":{"year":2016,"month":8,"day":12,"name":"es5"},"title":"elasticsearch系列笔记(五) 结构化查询","permalink":"http://catlittlechen.com/2016/08/12/es5/","content":"<h4 id=\"u7ED3_u6784_u5316_u67E5_u8BE2Query_DSL\"><a href=\"#u7ED3_u6784_u5316_u67E5_u8BE2Query_DSL\" class=\"headerlink\" title=\"结构化查询Query DSL\"></a>结构化查询Query DSL</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /_search</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">            QUERY_NAME: &#123;</span><br><span class=\"line\">                FIELD_NAME: &#123;</span><br><span class=\"line\">                    ARGUMENT: VALUE,</span><br><span class=\"line\">                    ARGUMENT: VALUE,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u8FC7_u6EE4_u67E5_u8BE2Filter_DSL\"><a href=\"#u8FC7_u6EE4_u67E5_u8BE2Filter_DSL\" class=\"headerlink\" title=\"过滤查询Filter DSL\"></a>过滤查询Filter DSL</h4><h4 id=\"term__u8FC7_u6EE4\"><a href=\"#term__u8FC7_u6EE4\" class=\"headerlink\" title=\"term 过滤\"></a>term 过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"collection\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"term\"</span>: <span class=\"collection\">&#123;</span><br><span class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: <span class=\"collection\">&#123;value&#125;</span> </span><br><span class=\"line\">    &#125;</span></span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"terms__u8FC7_u6EE4\"><a href=\"#terms__u8FC7_u6EE4\" class=\"headerlink\" title=\"terms 过滤\"></a>terms 过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"collection\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"terms\"</span>: <span class=\"collection\">&#123;</span><br><span class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: <span class=\"collection\">[ <span class=\"collection\">&#123;value1&#125;</span>, <span class=\"collection\">&#123;value2&#125;</span> ]</span></span><br><span class=\"line\">    &#125;</span></span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"range_u8FC7_u6EE4\"><a href=\"#range_u8FC7_u6EE4\" class=\"headerlink\" title=\"range过滤\"></a>range过滤</h4><figure class=\"highlight dust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"></span><span class=\"expression\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"range\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"&#123;field&#125;\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"gte\"</span>: 20, /<span class=\"end-block\">/<span class=\"keyword\">gt</span> <span class=\"keyword\">gte</span></span>, <span class=\"variable\"><span class=\"keyword\">lt</span></span> <span class=\"variable\"><span class=\"keyword\">lte</span></span></span><br><span class=\"line\">        &#125;</span><span class=\"xml\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"exits_2C_missing_u8FC7_u6EE4\"><a href=\"#exits_2C_missing_u8FC7_u6EE4\" class=\"headerlink\" title=\"exits, missing过滤\"></a>exits, missing过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"collection\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"exists\"</span>: <span class=\"collection\">&#123;</span><br><span class=\"line\">        <span class=\"string\">\"field\"</span>: <span class=\"string\">\"&#123;field&#125;\"</span>,//存在这个类型</span><br><span class=\"line\">    &#125;</span></span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"u8FC7_u6EE4\"><a href=\"#u8FC7_u6EE4\" class=\"headerlink\" title=\"过滤\"></a>过滤</h4><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"collection\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"bool\"</span>: <span class=\"collection\">&#123;</span><br><span class=\"line\">        <span class=\"string\">\"must\"</span>: <span class=\"collection\">&#123;&#125;</span>,//必须符合</span><br><span class=\"line\">        <span class=\"string\">\"must_not\"</span>: <span class=\"collection\">&#123;&#125;</span>,//必须不符合</span><br><span class=\"line\">        <span class=\"string\">\"should\"</span>: <span class=\"collection\">&#123;&#125;</span>,//必须符合其中一个条件</span><br><span class=\"line\">    &#125;</span></span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"match_all\"><a href=\"#match_all\" class=\"headerlink\" title=\"match_all\"></a>match_all</h4><h4 id=\"match\"><a href=\"#match\" class=\"headerlink\" title=\"match\"></a>match</h4><h4 id=\"multi_match\"><a href=\"#multi_match\" class=\"headerlink\" title=\"multi_match\"></a>multi_match</h4><h4 id=\"u67E5_u8BE2_u6BD4_u8FC7_u6EE4_u591A_u4E86_u76F8_u5173_u6027_u8BA1_u7B97\"><a href=\"#u67E5_u8BE2_u6BD4_u8FC7_u6EE4_u591A_u4E86_u76F8_u5173_u6027_u8BA1_u7B97\" class=\"headerlink\" title=\"查询比过滤多了相关性计算\"></a>查询比过滤多了相关性计算</h4><h4 id=\"u590D_u5408_u67E5_u8BE2\"><a href=\"#u590D_u5408_u67E5_u8BE2\" class=\"headerlink\" title=\"复合查询\"></a>复合查询</h4><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   \t\"<span class=\"attribute\">filtered</span>\": <span class=\"value\">&#123;</span><br><span class=\"line\">       \t\"<span class=\"attribute\">query</span>\":  <span class=\"value\">&#123; \"<span class=\"attribute\">match</span>\": <span class=\"value\">&#123; \"<span class=\"attribute\">email</span>\": <span class=\"value\"><span class=\"string\">\"business opportunity\"</span> </span>&#125;</span>&#125;</span>,</span><br><span class=\"line\">       \t\"<span class=\"attribute\">filter</span>\": <span class=\"value\">&#123; \"<span class=\"attribute\">term</span>\":  <span class=\"value\">&#123; \"<span class=\"attribute\">folder</span>\": <span class=\"value\"><span class=\"string\">\"inbox\"</span> </span>&#125;</span>&#125;</span><br><span class=\"line\">   \t</span>&#125;</span><br><span class=\"line\"></span>&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u9A8C_u8BC1_u67E5_u8BE2_uFF0C_u89E3_u91CA_u9519_u8BEF\"><a href=\"#u9A8C_u8BC1_u67E5_u8BE2_uFF0C_u89E3_u91CA_u9519_u8BEF\" class=\"headerlink\" title=\"验证查询，解释错误\"></a>验证查询，解释错误</h4><figure class=\"highlight gherkin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /gb/tweet/_validate/query?explain</span><br><span class=\"line\">   \t&#123;</span><br><span class=\"line\">       \t<span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">           \t<span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span></span><br><span class=\"line\">       \t&#125;</span><br><span class=\"line\">   \t&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u6392_u5E8F_uFF0C_u5728query_u4E4B_u540E\"><a href=\"#u6392_u5E8F_uFF0C_u5728query_u4E4B_u540E\" class=\"headerlink\" title=\"排序，在query之后\"></a>排序，在query之后</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   \t<span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">   \t&#125;,</span><br><span class=\"line\">   \t<span class=\"string\">\"sort\"</span>: &#123;</span><br><span class=\"line\">   \t\t<span class=\"string\">\"&#123;field&#125;\"</span>:&#123;</span><br><span class=\"line\">   \t\t\t<span class=\"string\">\"order\"</span>: <span class=\"string\">\"desc\"</span></span><br><span class=\"line\">   \t\t&#125;,</span><br><span class=\"line\">   \t\t<span class=\"string\">\"&#123;field&#125;\"</span>:&#123;</span><br><span class=\"line\">   \t\t\t<span class=\"string\">\"order\"</span>: <span class=\"string\">\"asc\"</span>,</span><br><span class=\"line\">   \t\t\t<span class=\"string\">\"mode\"</span>: <span class=\"string\">\"min\"</span> //field为多个值时</span><br><span class=\"line\">       \t&#125;</span><br><span class=\"line\">   \t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"}