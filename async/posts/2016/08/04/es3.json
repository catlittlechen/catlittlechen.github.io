{"tags":[{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":13},{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/04/es3.json","date":1470312711000,"path":{"year":2016,"month":8,"day":4,"name":"es3"},"title":"elasticsearch系列笔记(三) 基本API","permalink":"http://catlittlechen.com/2016/08/04/es3/","content":"<h4 id=\"添加文档-自定义ID\"><a href=\"#添加文档-自定义ID\" class=\"headerlink\" title=\"添加文档,自定义ID\"></a>添加文档,自定义ID</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"field\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加文档，这时候的ID是ES自动生成，为22位的UUIDS\"><a href=\"#添加文档，这时候的ID是ES自动生成，为22位的UUIDS\" class=\"headerlink\" title=\"添加文档，这时候的ID是ES自动生成，为22位的UUIDS\"></a>添加文档，这时候的ID是ES自动生成，为22位的UUIDS</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /&#123;index&#125;/&#123;type&#125;/</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"field\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"获得文档\"><a href=\"#获得文档\" class=\"headerlink\" title=\"获得文档\"></a>获得文档</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;?pretty</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"_index\"</span> :   <span class=\"string\">\"&#123;index&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_type\"</span> :    <span class=\"string\">\"&#123;type&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_id\"</span> :      <span class=\"string\">\"&#123;id&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_version\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"found\"</span> :    true, //是否找到，<span class=\"number\">404</span>同步返回</span><br><span class=\"line\">    <span class=\"string\">\"_source\"</span> :  &#123;</span><br><span class=\"line\">        <span class=\"string\">\"field\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"获得文档的特定属性\"><a href=\"#获得文档的特定属性\" class=\"headerlink\" title=\"获得文档的特定属性\"></a>获得文档的特定属性</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;/&#123;key&#125;?pretty</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"&#123;key&#125;\"</span>: <span class=\"string\">\"value\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">key 为上面json的值</span><br></pre></td></tr></table></figure>\n<h4 id=\"获得文档的特定值\"><a href=\"#获得文档的特定值\" class=\"headerlink\" title=\"获得文档的特定值\"></a>获得文档的特定值</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;?pretty&amp;_source=&#123;field1&#125;,&#123;field2&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"_index\"</span> :   <span class=\"string\">\"&#123;index&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_type\"</span> :    <span class=\"string\">\"&#123;type&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_id\"</span> :      <span class=\"string\">\"&#123;id&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_version\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"found\"</span> :    true, //是否找到，<span class=\"number\">404</span>同步返回</span><br><span class=\"line\">    <span class=\"string\">\"_source\"</span> :  &#123;</span><br><span class=\"line\">        <span class=\"string\">\"field1\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"field2\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"检查文档是否存在\"><a href=\"#检查文档是否存在\" class=\"headerlink\" title=\"检查文档是否存在\"></a>检查文档是否存在</h4><figure class=\"highlight dust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\">HEAD /</span><span class=\"template-variable\">&#123;index&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;type&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;id&#125;</span><span class=\"xml\"></span></span><br></pre></td></tr></table></figure>\n<h4 id=\"更新文档的时候，写法和插入时相同\"><a href=\"#更新文档的时候，写法和插入时相同\" class=\"headerlink\" title=\"更新文档的时候，写法和插入时相同\"></a>更新文档的时候，写法和插入时相同</h4><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_<span class=\"keyword\">version</span>会递增</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建文档，成功创建的时候，返回201，失败返回409\"><a href=\"#创建文档，成功创建的时候，返回201，失败返回409\" class=\"headerlink\" title=\"创建文档，成功创建的时候，返回201，失败返回409\"></a>创建文档，成功创建的时候，返回201，失败返回409</h4><figure class=\"highlight dust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\">PUT /</span><span class=\"template-variable\">&#123;index&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;type&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;id&#125;</span><span class=\"xml\">?op_type=create</span></span><br><span class=\"line\"><span class=\"xml\">PUT /</span><span class=\"template-variable\">&#123;index&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;type&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;id&#125;</span><span class=\"xml\">/_create</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"删除文档，失败返回404\"><a href=\"#删除文档，失败返回404\" class=\"headerlink\" title=\"删除文档，失败返回404\"></a>删除文档，失败返回404</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> /&#123;<span class=\"keyword\">index</span>&#125;/&#123;<span class=\"keyword\">type</span>&#125;/&#123;<span class=\"keyword\">id</span>&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"更新某个特定版本的文档，用于控制并发错误，version-type设置了用此时的version来设置文档的version\"><a href=\"#更新某个特定版本的文档，用于控制并发错误，version-type设置了用此时的version来设置文档的version\" class=\"headerlink\" title=\"更新某个特定版本的文档，用于控制并发错误，version_type设置了用此时的version来设置文档的version\"></a>更新某个特定版本的文档，用于控制并发错误，version_type设置了用此时的version来设置文档的version</h4><figure class=\"highlight dust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\">PUT /</span><span class=\"template-variable\">&#123;index&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;type&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;id&#125;</span><span class=\"xml\">?version=</span><span class=\"template-variable\">&#123;version&#125;</span><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">PUT /</span><span class=\"template-variable\">&#123;index&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;type&#125;</span><span class=\"xml\">/</span><span class=\"template-variable\">&#123;id&#125;</span><span class=\"xml\">?version=</span><span class=\"template-variable\">&#123;version&#125;</span><span class=\"xml\">&amp;version_type=external</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"更新文档的部分内容，合并文档\"><a href=\"#更新文档的部分内容，合并文档\" class=\"headerlink\" title=\"更新文档的部分内容，合并文档\"></a>更新文档的部分内容，合并文档</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;/_<span class=\"keyword\">update</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"脚本是一些奇怪的逻辑，不过蛮好玩的。\"><a href=\"#脚本是一些奇怪的逻辑，不过蛮好玩的。\" class=\"headerlink\" title=\"脚本是一些奇怪的逻辑，不过蛮好玩的。\"></a>脚本是一些奇怪的逻辑，不过蛮好玩的。</h4><h4 id=\"检索多个文档\"><a href=\"#检索多个文档\" class=\"headerlink\" title=\"检索多个文档\"></a>检索多个文档</h4><figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">POST</span> /_mget</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"docs\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\"><span class=\"comment\">            *******</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"批量操作，以换行符来判断，防止不必要的json解析等数据拷贝。\"><a href=\"#批量操作，以换行符来判断，防止不必要的json解析等数据拷贝。\" class=\"headerlink\" title=\"批量操作，以换行符来判断，防止不必要的json解析等数据拷贝。\"></a>批量操作，以换行符来判断，防止不必要的json解析等数据拷贝。</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /_bulk</span><br><span class=\"line\">&#123; action: &#123;metadata &#125;&#125; \\n</span><br><span class=\"line\">&#123; request body &#125; \\n</span><br><span class=\"line\">&#123; action: &#123;metadata &#125;&#125; \\n</span><br><span class=\"line\">&#123; request body &#125; \\n</span><br></pre></td></tr></table></figure>\n"}