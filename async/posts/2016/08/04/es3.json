{"tags":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/tags/elasticsearch/","url":"/async/tags/elasticsearch.json","count":6},{"name":"学习","permalink":"http://catlittlechen.com/tags/学习/","url":"/async/tags/学习.json","count":6}],"categories":[{"name":"elasticsearch","permalink":"http://catlittlechen.com/categories/elasticsearch/","url":"/async/categories/elasticsearch.json","count":6}],"url":"/async/posts/2016/08/04/es3.json","date":1470312711000,"path":{"year":2016,"month":8,"day":4,"name":"es3"},"title":"elasticsearch系列笔记(三) 基本API","permalink":"http://catlittlechen.com/2016/08/04/es3/","content":"<h4 id=\"u6DFB_u52A0_u6587_u6863_2C_u81EA_u5B9A_u4E49ID\"><a href=\"#u6DFB_u52A0_u6587_u6863_2C_u81EA_u5B9A_u4E49ID\" class=\"headerlink\" title=\"添加文档,自定义ID\"></a>添加文档,自定义ID</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"field\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u6DFB_u52A0_u6587_u6863_uFF0C_u8FD9_u65F6_u5019_u7684ID_u662FES_u81EA_u52A8_u751F_u6210_uFF0C_u4E3A22_u4F4D_u7684UUIDS\"><a href=\"#u6DFB_u52A0_u6587_u6863_uFF0C_u8FD9_u65F6_u5019_u7684ID_u662FES_u81EA_u52A8_u751F_u6210_uFF0C_u4E3A22_u4F4D_u7684UUIDS\" class=\"headerlink\" title=\"添加文档，这时候的ID是ES自动生成，为22位的UUIDS\"></a>添加文档，这时候的ID是ES自动生成，为22位的UUIDS</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /&#123;index&#125;/&#123;type&#125;/</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"field\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u83B7_u5F97_u6587_u6863\"><a href=\"#u83B7_u5F97_u6587_u6863\" class=\"headerlink\" title=\"获得文档\"></a>获得文档</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;?pretty</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"_index\"</span> :   <span class=\"string\">\"&#123;index&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_type\"</span> :    <span class=\"string\">\"&#123;type&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_id\"</span> :      <span class=\"string\">\"&#123;id&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_version\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"found\"</span> :    true, //是否找到，<span class=\"number\">404</span>同步返回</span><br><span class=\"line\">    <span class=\"string\">\"_source\"</span> :  &#123;</span><br><span class=\"line\">        <span class=\"string\">\"field\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u83B7_u5F97_u6587_u6863_u7684_u7279_u5B9A_u5C5E_u6027\"><a href=\"#u83B7_u5F97_u6587_u6863_u7684_u7279_u5B9A_u5C5E_u6027\" class=\"headerlink\" title=\"获得文档的特定属性\"></a>获得文档的特定属性</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;/&#123;key&#125;?pretty</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"&#123;key&#125;\"</span>: <span class=\"string\">\"value\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">key 为上面json的值</span><br></pre></td></tr></table></figure>\n<h4 id=\"u83B7_u5F97_u6587_u6863_u7684_u7279_u5B9A_u503C\"><a href=\"#u83B7_u5F97_u6587_u6863_u7684_u7279_u5B9A_u503C\" class=\"headerlink\" title=\"获得文档的特定值\"></a>获得文档的特定值</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;?pretty&amp;_source=&#123;field1&#125;,&#123;field2&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"_index\"</span> :   <span class=\"string\">\"&#123;index&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_type\"</span> :    <span class=\"string\">\"&#123;type&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_id\"</span> :      <span class=\"string\">\"&#123;id&#125;\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"_version\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"found\"</span> :    true, //是否找到，<span class=\"number\">404</span>同步返回</span><br><span class=\"line\">    <span class=\"string\">\"_source\"</span> :  &#123;</span><br><span class=\"line\">        <span class=\"string\">\"field1\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"field2\"</span>: <span class=\"string\">\"value\"</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u68C0_u67E5_u6587_u6863_u662F_u5426_u5B58_u5728\"><a href=\"#u68C0_u67E5_u6587_u6863_u662F_u5426_u5B58_u5728\" class=\"headerlink\" title=\"检查文档是否存在\"></a>检查文档是否存在</h4><figure class=\"highlight elm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">HEAD</span> /&#123;index&#125;/&#123;<span class=\"typedef\"><span class=\"keyword\">type</span>&#125;/<span class=\"container\">&#123;id&#125;</span></span></span><br></pre></td></tr></table></figure>\n<h4 id=\"u66F4_u65B0_u6587_u6863_u7684_u65F6_u5019_uFF0C_u5199_u6CD5_u548C_u63D2_u5165_u65F6_u76F8_u540C\"><a href=\"#u66F4_u65B0_u6587_u6863_u7684_u65F6_u5019_uFF0C_u5199_u6CD5_u548C_u63D2_u5165_u65F6_u76F8_u540C\" class=\"headerlink\" title=\"更新文档的时候，写法和插入时相同\"></a>更新文档的时候，写法和插入时相同</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_version会递增</span><br></pre></td></tr></table></figure>\n<h4 id=\"u521B_u5EFA_u6587_u6863_uFF0C_u6210_u529F_u521B_u5EFA_u7684_u65F6_u5019_uFF0C_u8FD4_u56DE201_uFF0C_u5931_u8D25_u8FD4_u56DE409\"><a href=\"#u521B_u5EFA_u6587_u6863_uFF0C_u6210_u529F_u521B_u5EFA_u7684_u65F6_u5019_uFF0C_u8FD4_u56DE201_uFF0C_u5931_u8D25_u8FD4_u56DE409\" class=\"headerlink\" title=\"创建文档，成功创建的时候，返回201，失败返回409\"></a>创建文档，成功创建的时候，返回201，失败返回409</h4><figure class=\"highlight elm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">PUT</span> /&#123;index&#125;/&#123;<span class=\"typedef\"><span class=\"keyword\">type</span>&#125;/<span class=\"container\">&#123;id&#125;</span>?op_type=create</span></span><br><span class=\"line\"><span class=\"type\">PUT</span> /&#123;index&#125;/&#123;<span class=\"typedef\"><span class=\"keyword\">type</span>&#125;/<span class=\"container\">&#123;id&#125;</span>/_create</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"u5220_u9664_u6587_u6863_uFF0C_u5931_u8D25_u8FD4_u56DE404\"><a href=\"#u5220_u9664_u6587_u6863_uFF0C_u5931_u8D25_u8FD4_u56DE404\" class=\"headerlink\" title=\"删除文档，失败返回404\"></a>删除文档，失败返回404</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">DELETE</span> /&#123;<span class=\"keyword\">index</span>&#125;/&#123;<span class=\"keyword\">type</span>&#125;/&#123;<span class=\"keyword\">id</span>&#125;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"u66F4_u65B0_u67D0_u4E2A_u7279_u5B9A_u7248_u672C_u7684_u6587_u6863_uFF0C_u7528_u4E8E_u63A7_u5236_u5E76_u53D1_u9519_u8BEF_uFF0Cversion_type_u8BBE_u7F6E_u4E86_u7528_u6B64_u65F6_u7684version_u6765_u8BBE_u7F6E_u6587_u6863_u7684version\"><a href=\"#u66F4_u65B0_u67D0_u4E2A_u7279_u5B9A_u7248_u672C_u7684_u6587_u6863_uFF0C_u7528_u4E8E_u63A7_u5236_u5E76_u53D1_u9519_u8BEF_uFF0Cversion_type_u8BBE_u7F6E_u4E86_u7528_u6B64_u65F6_u7684version_u6765_u8BBE_u7F6E_u6587_u6863_u7684version\" class=\"headerlink\" title=\"更新某个特定版本的文档，用于控制并发错误，version_type设置了用此时的version来设置文档的version\"></a>更新某个特定版本的文档，用于控制并发错误，version_type设置了用此时的version来设置文档的version</h4><figure class=\"highlight elm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">PUT</span> /&#123;index&#125;/&#123;<span class=\"typedef\"><span class=\"keyword\">type</span>&#125;/<span class=\"container\">&#123;id&#125;</span>?version=<span class=\"container\">&#123;version&#125;</span></span></span><br><span class=\"line\"><span class=\"type\">PUT</span> /&#123;index&#125;/&#123;<span class=\"typedef\"><span class=\"keyword\">type</span>&#125;/<span class=\"container\">&#123;id&#125;</span>?version=<span class=\"container\">&#123;version&#125;</span>&amp;version_type=external</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"u66F4_u65B0_u6587_u6863_u7684_u90E8_u5206_u5185_u5BB9_uFF0C_u5408_u5E76_u6587_u6863\"><a href=\"#u66F4_u65B0_u6587_u6863_u7684_u90E8_u5206_u5185_u5BB9_uFF0C_u5408_u5E76_u6587_u6863\" class=\"headerlink\" title=\"更新文档的部分内容，合并文档\"></a>更新文档的部分内容，合并文档</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /&#123;index&#125;/&#123;type&#125;/&#123;id&#125;/_<span class=\"keyword\">update</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"u811A_u672C_u662F_u4E00_u4E9B_u5947_u602A_u7684_u903B_u8F91_uFF0C_u4E0D_u8FC7_u86EE_u597D_u73A9_u7684_u3002\"><a href=\"#u811A_u672C_u662F_u4E00_u4E9B_u5947_u602A_u7684_u903B_u8F91_uFF0C_u4E0D_u8FC7_u86EE_u597D_u73A9_u7684_u3002\" class=\"headerlink\" title=\"脚本是一些奇怪的逻辑，不过蛮好玩的。\"></a>脚本是一些奇怪的逻辑，不过蛮好玩的。</h4><h4 id=\"u68C0_u7D22_u591A_u4E2A_u6587_u6863\"><a href=\"#u68C0_u7D22_u591A_u4E2A_u6587_u6863\" class=\"headerlink\" title=\"检索多个文档\"></a>检索多个文档</h4><figure class=\"highlight gherkin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /_mget</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"docs\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span><span class=\"keyword\">*</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"u6279_u91CF_u64CD_u4F5C_uFF0C_u4EE5_u6362_u884C_u7B26_u6765_u5224_u65AD_uFF0C_u9632_u6B62_u4E0D_u5FC5_u8981_u7684json_u89E3_u6790_u7B49_u6570_u636E_u62F7_u8D1D_u3002\"><a href=\"#u6279_u91CF_u64CD_u4F5C_uFF0C_u4EE5_u6362_u884C_u7B26_u6765_u5224_u65AD_uFF0C_u9632_u6B62_u4E0D_u5FC5_u8981_u7684json_u89E3_u6790_u7B49_u6570_u636E_u62F7_u8D1D_u3002\" class=\"headerlink\" title=\"批量操作，以换行符来判断，防止不必要的json解析等数据拷贝。\"></a>批量操作，以换行符来判断，防止不必要的json解析等数据拷贝。</h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /_bulk</span><br><span class=\"line\">&#123; action: &#123;metadata &#125;&#125; \\n</span><br><span class=\"line\">&#123; request body &#125; \\n</span><br><span class=\"line\">&#123; action: &#123;metadata &#125;&#125; \\n</span><br><span class=\"line\">&#123; request body &#125; \\n</span><br></pre></td></tr></table></figure>\n"}