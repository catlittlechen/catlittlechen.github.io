{"tags":[{"name":"nginx","permalink":"http://catlittlechen.com/tags/nginx/","url":"/async/tags/nginx.json","count":1},{"name":"踩坑日记","permalink":"http://catlittlechen.com/tags/踩坑日记/","url":"/async/tags/踩坑日记.json","count":9}],"categories":[{"name":"nginx","permalink":"http://catlittlechen.com/categories/nginx/","url":"/async/categories/nginx.json","count":1}],"url":"/async/posts/2017/08/10/nginx.json","date":1502380031000,"path":{"year":2017,"month":8,"day":10,"name":"nginx"},"title":"nginx-limit—req 的坑","permalink":"http://catlittlechen.com/2017/08/10/nginx/","content":"<p>一般我们都认为nginx -t可以测试出配置文件是否配置正确。<br>其实不然~</p>\n<h4 id=\"limit_req_zone\"><a href=\"#limit_req_zone\" class=\"headerlink\" title=\"limit_req_zone\"></a><code>limit_req_zone</code></h4><figure class=\"highlight xquery\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">limit_req_zone  <span class=\"variable\">$binary</span>_remote_addr  zone=req_one:<span class=\"number\">10</span>m rate=<span class=\"number\">1</span>r/s</span><br></pre></td></tr></table></figure>\n<p>这是nginx配置速率限制的插件。具体可以自行查询相关资料。</p>\n<h4 id=\"u5751\"><a href=\"#u5751\" class=\"headerlink\" title=\"坑\"></a>坑</h4><p>当时原本设置的限制条件为$uri，测试的过程中，发现实际上$request_uri才是符合要求的限制条件，因而修改了配置，<code>nginx -t</code>测试顺利通过，<code>nginx -s reload</code>也没有任何报错。但是实际上，nginx worker并没有退出。</p>\n<p>一开始还认为是worker承载的请求太多，以至于请求没能处理完毕，导师worker延迟退出。<br>直到多心去看了一眼日志，才发现，limit_req这个模块，在设置<code>limit_req_zone</code>的时候是无法修改限制条件的。</p>\n<h4 id=\"u65B9_u6CD5\"><a href=\"#u65B9_u6CD5\" class=\"headerlink\" title=\"方法\"></a>方法</h4><p>只能够同时修改zone~~~</p>\n"}