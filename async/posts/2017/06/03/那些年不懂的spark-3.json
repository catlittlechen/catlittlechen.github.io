{"tags":[{"name":"spark","permalink":"http://catlittlechen.com/tags/spark/","url":"/async/tags/spark.json","count":4},{"name":"踩坑日记","permalink":"http://catlittlechen.com/tags/踩坑日记/","url":"/async/tags/踩坑日记.json","count":8}],"categories":[{"name":"spark","permalink":"http://catlittlechen.com/categories/spark/","url":"/async/categories/spark.json","count":4}],"url":"/async/posts/2017/06/03/那些年不懂的spark-3.json","date":1496463225000,"path":{"year":2017,"month":6,"day":3,"name":"那些年不懂的spark-3"},"title":"那些年不懂的spark(3)","permalink":"http://catlittlechen.com/2017/06/03/那些年不懂的spark-3/","content":"<p>aws的emr起来之后，默认的磁盘很小，所以长期跑任务的时候，经常会因为磁盘不够，导致节点失败。而且，这种情况下的emr，是不会自动修复的。</p>\n<h2 id=\"spark-history\"><a href=\"#spark-history\" class=\"headerlink\" title=\"spark-history\"></a>spark-history</h2><p>spark-default.xml<br><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spark<span class=\"class\">.history</span><span class=\"class\">.fs</span><span class=\"class\">.cleaner</span><span class=\"class\">.enabled</span> true</span><br><span class=\"line\">spark<span class=\"class\">.history</span><span class=\"class\">.fs</span><span class=\"class\">.cleaner</span><span class=\"class\">.interval</span> <span class=\"number\">1</span>m</span><br><span class=\"line\">spark<span class=\"class\">.history</span><span class=\"class\">.fs</span><span class=\"class\">.cleaner</span><span class=\"class\">.maxAge</span> <span class=\"number\">1</span>h</span><br></pre></td></tr></table></figure></p>\n<p>spark-history里面保存着spark的application的log，因此如果不需要的话，可以把清理的时间变短一下。</p>\n<h2 id=\"spark-yarn\"><a href=\"#spark-yarn\" class=\"headerlink\" title=\"spark-yarn\"></a>spark-yarn</h2><p>yarn-site.xml<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"title\">name</span>&gt;</span>yarn.nodemanager.localizer.cache.target-size-mb<span class=\"tag\">&lt;/<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"title\">value</span>&gt;</span>5120<span class=\"tag\">&lt;/<span class=\"title\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">property</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"title\">name</span>&gt;</span>yarn.nodemanager.localizer.cache.cleanup.interval-ms<span class=\"tag\">&lt;/<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"title\">value</span>&gt;</span>30000<span class=\"tag\">&lt;/<span class=\"title\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>spark执行任务的时候，会将自身需要的jar放到hadoop上，导致hadoop的磁盘会缓存下一堆的目录，也是可以定期清理的。</p>\n<h2 id=\"u7ED3_u5C40\"><a href=\"#u7ED3_u5C40\" class=\"headerlink\" title=\"结局\"></a>结局</h2><p>未完待续</p>\n<h2 id=\"Done\"><a href=\"#Done\" class=\"headerlink\" title=\"Done\"></a>Done</h2>"}