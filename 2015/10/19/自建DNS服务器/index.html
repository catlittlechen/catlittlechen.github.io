<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>自建DNS服务器 | CatChen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="今天有时间，我想看下自己建立DNS服务器，是怎么样的流程。结果发现是如此的简单。
以下是基于ubuntu的。
DNS域名管理系统DNS(Domain Name System)，是通过域名来解析到IP的一种网络服务，自建DNS服务器，可以在内网中，自己设定特定的域名解析，达到内网机器可以无需配置host，达到访问内网服务的作用。
DNS记录(备忘)：
A记录：        主机名或者域名 –&amp;gt">
<meta property="og:type" content="article">
<meta property="og:title" content="自建DNS服务器">
<meta property="og:url" content="http://catlittlechen.com/2015/10/19/自建DNS服务器/index.html">
<meta property="og:site_name" content="CatChen">
<meta property="og:description" content="今天有时间，我想看下自己建立DNS服务器，是怎么样的流程。结果发现是如此的简单。
以下是基于ubuntu的。
DNS域名管理系统DNS(Domain Name System)，是通过域名来解析到IP的一种网络服务，自建DNS服务器，可以在内网中，自己设定特定的域名解析，达到内网机器可以无需配置host，达到访问内网服务的作用。
DNS记录(备忘)：
A记录：        主机名或者域名 –&amp;gt">
<meta property="og:image" content="http://7xnn4y.com1.z0.glb.clouddn.com/2.png">
<meta property="og:image" content="http://7xnn4y.com1.z0.glb.clouddn.com/3.png">
<meta property="og:updated_time" content="2015-10-21T00:35:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自建DNS服务器">
<meta name="twitter:description" content="今天有时间，我想看下自己建立DNS服务器，是怎么样的流程。结果发现是如此的简单。
以下是基于ubuntu的。
DNS域名管理系统DNS(Domain Name System)，是通过域名来解析到IP的一种网络服务，自建DNS服务器，可以在内网中，自己设定特定的域名解析，达到内网机器可以无需配置host，达到访问内网服务的作用。
DNS记录(备忘)：
A记录：        主机名或者域名 –&amp;gt">
  
    <link rel="alternative" href="/atom.xml" title="CatChen" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">CatChen</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">我的王国，我一定会让你永垂不朽的</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">文章</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://catlittlechen.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-自建DNS服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/19/自建DNS服务器/" class="article-date">
  <time datetime="2015-10-19T11:41:33.000Z" itemprop="datePublished">2015-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      自建DNS服务器
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天有时间，我想看下自己建立DNS服务器，是怎么样的流程。<br>结果发现是如此的简单。</p>
<p>以下是基于ubuntu的。</p>
<h2 id="DNS">DNS</h2><p>域名管理系统DNS(Domain Name System)，是通过域名来解析到IP的一种网络服务，自建DNS服务器，可以在内网中，自己设定特定的域名解析，达到内网机器可以无需配置host，达到访问内网服务的作用。</p>
<h3 id="DNS记录(备忘)：">DNS记录(备忘)：</h3><ul>
<li>A记录：        主机名或者域名 –&gt; 相应的IP地址；</li>
<li>NS记录：        记录域名有哪些DNS服务器来解析；</li>
<li>CHAME记录：    将域名的解析转到另外一个域名上去；</li>
<li>MX记录：        一个网络里面的电子邮件服务引导到特定服务器；</li>
<li>TXT记录：        提供了域名的文本信息；</li>
</ul>
<h2 id="Bind9">Bind9</h2><p>bind(berkeley Internet Name Daemon)<br>建立DNS服务器，在ubuntu下只需要安装bind9就可以了。<br>    <figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install bind9</span><br></pre></td></tr></table></figure></p>
<h3 id="服务器">服务器</h3><p>bind9可以配置多种DNS服务器:</p>
<ol>
<li>缓冲服务器，用于缓存DNS服务，减少带宽使用；</li>
<li>主服务器，用于记录DNS服务信息；</li>
<li>从服务器，完整的备份主服务器的内容；</li>
<li>混合服务器，多种服务器合并的累心；</li>
<li>私用的主从服务器；</li>
</ol>
<h3 id="主要配置">主要配置</h3><pre><code><span class="built_in">cd</span> /etc/<span class="built_in">bind</span>/
</code></pre><p>可以看出在目录下面有多个name.conf*的文件，为配置文件；db.*的文件为DNS记录文件；*.keys文件是Bind在交互过程中用于检验的秘钥。    </p>
<h4 id="name-conf-options">name.conf.options</h4><ul>
<li>forwarders: 选择现有的DNS提供商，以’;’分割，如果不写的话，这个地方会被默认为root名称服务器来解析，速度会特别慢；</li>
<li>directory “filename”: 用于存放该区域数据的文件；</li>
<li>forward first: 在尝试通过root服务器解析DNS请求先，对DNS请求进行转发(forward only 不进行转发)；</li>
<li>listen-on port *port{ ip-address;}: 指定监听哪一些网络接口(默认是127.0.0.1或者localhost)或者哪一个端口(默认是53)来监听客户端的查询；</li>
<li>listen-on-v6 *port{any;}: 指定Bind通过哪一个多端口去监听IPv6的客户端请求，any只可以被none代替；</li>
<li>query-source[-v6] address <em> port </em>: 服务器在查询解析的域名的时候，是有可能查询不到的而向其他服务器查询，因此，query-source可以设定这类查询采用什么样的地址和端口。这里的port只用于UDP的请求，TCP请求会随机使用一个大于1024的端口；</li>
<li>allow_query {ip-address;}: 指定说哪一些IP的网络可以进行普通的查询；</li>
<li>allow_transfer: 指定说哪一些IP的网络可以进行域的传输；</li>
<li>statistics-interval: 生成统计信息；设置为0，则不生成；</li>
<li>cleaning-interval: 缓存时间；</li>
<li>interface-interval: 定期检测网络接口中存在的接口，设置为0，则不扫描；</li>
<li>notify no: 在区域数据改动或者重启服务时，是否通知其他服务器；</li>
<li>dump-file “filename”: 执行rndc dumpdb时，存放的路径；</li>
</ul>
<h4 id="name-conf_logging">name.conf logging</h4><pre><code> <span class="tag">logging</span> {
       <span class="attr_selector">[ channel channel_name {
         ( file path_name
         [ versions ( number | unlimited ) ]</span>
         <span class="attr_selector">[ size size_spec ]</span>
         <span class="attr_selector">[ syslog (syslog_facility） | stderr | null)]</span>;
         <span class="attr_selector">[ severity (critical | error | warning | notice | info | debug [ level ]</span> | <span class="tag">dynamic</span> ); ]
         <span class="attr_selector">[ print-category yes | no; ]</span>
         <span class="attr_selector">[ print-severity yes | no; ]</span>
         <span class="attr_selector">[ print-time yes | no; ]</span>
       }; ]
       <span class="attr_selector">[ category category_name {
         channel_name ; [ channel_name ; ... ]</span>
       }; ]
       ...
};
</code></pre><ul>
<li>file: 日志文件的路径；</li>
<li>versions, size: 用于控制日志文件的版本；<ol>
<li>如果size设置，versions没有设置，则写满日志文件之后，就会停止写入；</li>
<li>如果size，versions设置，则写满日志文件之后，会更新日志文件版本，继续写入；</li>
<li>如果size没设置，versions设置了，将会在Bind重启的时候再更新日志文件的版本；</li>
</ol>
</li>
<li>syslog, stderr, null: 三个参数填写出其中的一个，syslog会将输出的信息输出到系统日志中，详细的配置可以看下syslog，stderr将通道的输出信息重定向到标准错误流中，null则是忽略信息；</li>
<li>category: 这一部分的信息其实是将特定的输出内容写入指定的通道之中；具体有哪些种类的输出内容可以看下官方的介绍，种类太多也就不想列了。</li>
</ul>
<h4 id="name-conf_zone">name.conf zone</h4><p>在配置文件中，有name.conf.defaul-zones文件，已经默认的添加了部分DNS记录，而自建dns服务器，达到内网解析的关键，也就是配置这部分的文件。  </p>
<p>zone的配置模板目下所示：</p>
<pre><code><span class="title">zone</span> “catchenii.com” <span class="keyword">in</span> {
    <span class="typedef"><span class="keyword">type</span> master;</span>
    file <span class="string">"/etc/bind/db.catchenii.com"</span>
}
</code></pre><ul>
<li>type: 指DNS服务器的类型，分别为master(主服务器)，slave(从服务器)，hint(区域服务器)；</li>
<li>file: 区域数据文件；</li>
<li>master{server-ip-address}: 从服务器配置指定从哪个服务器中获取区域数据文件；</li>
<li>allow-update{!*;}: 是否允许外部创建DNS数据文件，默认是禁止的。(这一项就决定着有可能可以动态更新内网的DNS信息)  </li>
</ul>
<p>而对应的<strong>/etc/bind/db.catchenii.com</strong>区域数据文件则如图所示：<br><img src="http://7xnn4y.com1.z0.glb.clouddn.com/2.png" alt="db.catchenii.com"><br>区域文件有两种，一种是IP-&gt;域名，另外一种是域名-&gt;IP,上图当然是域名到IP得数据文件，两份记录的格式也是基本一致：</p>
<pre><code><span class="variable">'.</span><span class="variable">'在区域文件中是由重要的含义的，如果域名没有在末尾加入</span><span class="variable">'.</span><span class="variable">'，则会追加域名在后面，完整的域名必须在末尾加</span><span class="variable">'.</span><span class="variable">'。</span>
</code></pre><ul>
<li>$TTL: 默认的存活时间；</li>
<li>SOA: Start Of Authority 控制记录开始的位置。IN SOA后面是作为该区域的主服务器的名称。</li>
<li>Serial: 每修改一次文件，数字都会添加，用于告诉从服务器改变的通知；</li>
<li>Refresh: 下级服务器来校验serial number的时间间隔；</li>
<li>Retry: 下级服务器连接主服务器时出现错误的重试时间间隔；</li>
<li>Expire: 下级服务器无法联系主服务器时，缓存的超时时间；</li>
<li>Negative Cache TTL: 解析失败的记录的缓存时间；  </li>
</ul>
<p>接下来的数据为DNS的解析记录啦！</p>
<h3 id="结果">结果</h3><p>修改好文件之后，可以重启下服务：</p>
<pre><code><span class="label">sudo</span> /etc/init.d/<span class="keyword">bind9 </span>restart
</code></pre><p>效果如图所示：<br><img src="http://7xnn4y.com1.z0.glb.clouddn.com/3.png" alt="结果图"></p>
<p>嘻嘻。</p>
<h2 id="备记：">备记：</h2><p>各类DNS服务器的<a href="https://en.wikipedia.org/wiki/Comparison_of_DNS_server_software" target="_blank" rel="external">比较</a>!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://catlittlechen.com/2015/10/19/自建DNS服务器/" data-id="cih1f8u8j000c9izk1je414cm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/11/11/nagios和ganglia/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          nagios和ganglia
        
      </div>
    </a>
  
  
    <a href="/2015/09/29/虚拟化技术了解/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">虚拟化技术了解</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
<!-- 多说评论框 start -->
  <div class="ds-thread" data-category="$catid" data-thread-key="{id_encode("content_$catid",$id,$siteid)}" data-title="{new_addslashes($title)}"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
  var duoshuoQuery = {short_name:"catlittlechen"};
(function() {
 var ds = document.createElement('script');
 ds.type = 'text/javascript';ds.async = true;
 ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
 ds.charset = 'UTF-8';
 (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
 })();
</script>
  <!-- 多说公共JS代码 end -->
</section>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ganglias/">ganglias</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nagios/">nagios</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solr/">solr</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术/">技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活/">生活</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/监控/">监控</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/虚拟化/">虚拟化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/起点/">起点</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/踩坑日记/">踩坑日记</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">文章</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/11/13/仅仅/">仅仅</a>
          </li>
        
          <li>
            <a href="/2015/11/11/nagios和ganglia/">nagios和ganglia</a>
          </li>
        
          <li>
            <a href="/2015/10/19/自建DNS服务器/">自建DNS服务器</a>
          </li>
        
          <li>
            <a href="/2015/09/29/虚拟化技术了解/">虚拟化技术了解</a>
          </li>
        
          <li>
            <a href="/2015/09/25/c的模板类/">c的模板类</a>
          </li>
        
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Chan Cat<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>